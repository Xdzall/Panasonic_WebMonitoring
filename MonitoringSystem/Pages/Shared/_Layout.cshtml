@using MonitoringSystem.Data

@{
    string layoutMenu = ViewContext.HttpContext.Request.Cookies["layoutType"];
    string baseColor = "linear-gradient(109.6deg, rgb(61, 121, 176) 11.3%, rgb(35, 66, 164) 91.1%);";
    var title = ViewData["Title"] as string;
}

<!DOCTYPE html>
<html lang="en" class="reusable-bg-html">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - MonitoringSystem</title>

    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/background-style.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/Sidebar.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/Navbar.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/lib/fontawesome/css/all.min.css" />
    <link rel="stylesheet" href="~/css/sweetalert2.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/MonitoringSystem.styles.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/site-identity.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/lib/bootstrap-icons/font/bootstrap-icons.css" asp-append-version="true" />

    <script src="~/lib/chartjs/dist/chart.umd.js"></script>

     <style type="text/css">
        @@font-face {
            font-family: DINProCondensedMedium;
            src: url('/assets/fonts/DINPro-CondensedMedium.ttf') format('truetype');
            font-weight: 500;
            font-style: normal;
        }
    </style>

    <style>
    /* 1. BACKGROUND */
    body.reusable-bg {
        background-image: url('/assets/BackgroundPanamon.png') !important;
        background-size: cover !important;
        background-position: center !important;
        background-attachment: fixed !important;
        background-color: #2342A4 !important;
        margin: 0;
        padding: 0;
        overflow: hidden !important;
    }

    /* 2. HEADER */
    .main-header {
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        width: 100% !important;
        height:45px !important;
        background: transparent !important;
        z-index: 10 !important;
        pointer-events: none;
    }

    .header-content {
        display: flex !important;
        justify-content: space-between !important;
        align-items: center !important;
        height: 30px !important;
        padding: 0 25px !important;
        position: relative !important;
        margin-top: 9px !important;
    }

    .header-left {
    display: flex !important;
    align-items: center !important;
    height: 100% !important;
}

.header-left img {
    height: 12px !important; /* Sesuaikan tinggi gambar, bisa diganti 18px atau 22px */
    width: auto !important; /* Biar proporsi gambar tetap */
    object-fit: contain !important;
}

   .header-center {
    display: flex !important;
    align-items: center !important; /* ← UBAH dari baseline jadi center */
    gap: 0px !important;
    font-size: 15px !important;
    letter-spacing: 0.08em !important;
    font-family: "DINPro-CondensedMedium", -apple-system, BlinkMacSystemFont, sans-serif !important;
}

.header-center .brand-o {
    width: 14px !important; /* ← GEDEIN lagi dari 12px jadi 14px */
    height: 14px !important; /* ← GEDEIN lagi dari 12px jadi 14px */
    border: 2px solid #ffffff !important;
    border-radius: 50% !important;
    display: inline-block;
    position: relative;
    top: 1px !important;
}

/* Titik di tengah */
.header-center .brand-o::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 5px; /* ← GEDEIN titik juga dari 4px jadi 5px */
    height: 5px;
    background-color: #ffffff;
    border-radius: 50%;
}

.header-center span { 
    color: #ffffff !important;
    line-height: 1 !important; /* ← TAMBAH INI */
}
.header-center span:last-child {
    margin-left: -4px !important; /* ← N jadi rapat ke lingkaran */
}
    .header-right {
        font-family: 'Montserrat', 'Poppins', sans-serif !important;
        font-weight: 600 !important;
        font-size: 12px !important;
        color: #ffffff !important;
        display: flex !important;
        gap: 12px !important;
        align-items: center !important;
    }

    .header-right p { margin: 0 !important; }
    .header-right p:first-child::after { content: "|"; margin-left: 12px; color: #ffffff; }

   /* 9. SIDEBAR - ULTRA COMPACT (GAP 2PX) */
#bdSidebar {
    width: 75px !important; 
    margin: 4px 0 10px -2px !important; 
    height: calc(100vh - 70px) !important; 
    border-radius: 12px !important;
    position: relative !important;
    z-index: 30 !important;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2) !important;
    display: flex !important;
    flex-direction: column !important;
    padding: 8px 0 !important; /* Padding kotak sedikit ditambah agar simetris */
    overflow: hidden !important;
    background: rgba(255, 255, 255, 0.20) !important;
    border: 2px solid rgba(255, 255, 255, 0.3) !important;
    border-left: none !important;
}

#bdSidebar .mynav {
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    gap: 2px !important; /* JARAK ANTAR IKON PAS 2PX */
    padding: 0 !important;
    margin: 0 !important;
    width: 100% !important;
}

#bdSidebar .nav-item {
    width: 100% !important;
    display: flex !important;
    justify-content: center !important;
    margin: 0 !important; 
}

#bdSidebar .nav-item a {
    width: 88px !important;
    height: 56px !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: center !important;
    border-radius: 8px !important;
    background: transparent !important; /* ← TAMBAH INI */
    color: rgba(255, 255, 255, 0.5) !important;
    text-decoration: none !important;
    transition: all 0.2s ease !important;
    padding: 0 !important;
}

#bdSidebar .nav-item a:hover {
    background: rgba(255, 255, 255, 0.1) !important;
}

/* Active/Current Page Indicator - Garis Kiri */
#bdSidebar .nav-item a.active {
    color: #ffffff !important; /* Icon jadi putih penuh */
    position: relative;
}

#bdSidebar .nav-item a.active::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 3px;
    background: #ffffff;
    border-radius: 0 3px 3px 0;
}

/* Label Teks */
#bdSidebar .nav-label { 
    font-size: 8.5px !important; 
    font-weight: 500; 
    text-align: center; 
    line-height: 1.1; 
    white-space: nowrap; 
    letter-spacing: -0.1px;
}

/* Logout Button Style */
#bdSidebar .center form {
    margin: 0 !important;
    padding: 0 !important;
    width: 100% !important;
    display: flex !important;
    justify-content: center !important;
}

/* Logout Section - PUSH KE BOTTOM */
#bdSidebar .align-items-center.center {
    margin-top: auto !important;  /* INI YANG PENTING - push ke bawah */
    padding: 8px 0 !important;
    width: 100% !important;
    display: flex !important;
    justify-content: center !important;
}

/* Logout Button Style */
#bdSidebar .center form {
    margin: 0 !important;
    padding: 0 !important;
    width: 100% !important;
    display: flex !important;
    justify-content: center !important;
}

#bdSidebar .logout-btn {
    width: 88px !important;
    height: 50px !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: center !important;
    border-radius: 8px !important;
    background: transparent !important;
    border: none !important;
    color: #ff8a80 !important;
    cursor: pointer !important;
    text-decoration: none !important;
    padding: 0 !important;
    transition: all 0.2s ease !important;
}

#bdSidebar .logout-btn:hover {
    background: rgba(255, 138, 128, 0.1) !important;
    color: #ff5252 !important;
}

#bdSidebar .logout-btn i {
    font-size: 15px !important;
    margin-bottom: 2px !important;
}

#bdSidebar .logout-btn .nav-label {
    font-size: 9px !important;
    font-weight: 500 !important;
    text-align: center !important;
    line-height: 1.1 !important;
}
#bdSidebar .center a {
    width: 88px !important;
    height: 50px !important; 
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: center !important;
    border-radius: 8px !important;
    background: transparent !important; /* ← GANTI JADI TRANSPARENT */
    color: #ff8a80 !important;
    text-decoration: none !important;
}

#bdSidebar .center a i { font-size: 15px !important; margin-bottom: 2px !important; }
    #bdSidebar .nav-label { font-size: 9px !important; font-weight: 500; text-align: center; line-height: 1.1; }

    /* Logout Section */
    #bdSidebar .align-items-center.center {
        margin-top: auto !important;
        padding: 0 !important;
        width: 100% !important;
        display: flex !important;
        justify-content: center !important;
    }

    /* Logout Section */
#bdSidebar .align-items-center.center a {
    width: 70px !important;
    height: 70px !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: center !important;
    border-radius: 12px !important;
    background: transparent !important; /* ← GANTI TRANSPARENT */
    border: none !important; /* ← HAPUS BORDER */
    color: #f44336 !important;
    text-decoration: none !important;
}

    /* 10. CONTENT AREA */
    .main-content-wrapper {
        flex: 1;
        height: calc(100vh -45px);
        overflow: auto !important;
        padding-top: 3px;
    }

    .main-content-wrapper::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
}
    .main-content-wrapper::-webkit-scrollbar {
    width: 8px;
}

.main-content-wrapper::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.3);
    border-radius: 10px;
}

.main-content-wrapper::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.5);
}
    html, body { overflow: hidden !important; height: 100vh; margin: 0; }

    /* MODAL FIX */
    .modal-backdrop { display: none !important; }
    .modal { z-index: 1050 !important; pointer-events: auto !important; }
    body.modal-open #bdSidebar { pointer-events: none !important; opacity: 0.5; }

    #exportModal .modal-content {
        background: linear-gradient(180deg, #2d3548 0%, #1f2533 100%) !important;
        border: 1px solid rgba(255,255,255,0.2) !important;
        border-radius: 15px !important;
        color: white;
    }
  .footer-copyright {
    position: fixed !important;
    bottom: 5px !important;
    left: 0 !important;
    right: 0 !important;
    width: 100% !important;
    padding: 5px 0 !important;
    background: transparent !important;
    z-index: 5 !important;
    font-size: 10px !important;
}

.footer-copyright p {
    margin: 0 !important;
    opacity: 0.6 !important;
    color: #ffffff !important;
}
    </style>
</head>

<body class="reusable-bg">

    <header class="main-header">
        <div class="header-content">
            <div class="header-left"><img src="~/assets/PanasonicIcon.png" alt="Panasonic" /></div>
            <div class="header-center">
                <span>PANAM</span><span class="brand-o"></span><span>N</span>
            </div>

            <div class="header-right">
                <p id="current-date"></p>
                <p id="current-time"></p>
            </div>
        </div>
    </header>

    <div class="container-fluid p-0 d-flex" style="height: calc(100vh - 45px); margin-top:45px;">

        <div id="bdSidebar" class="d-flex flex-column flex-shrink-0 text-white offcanvas-md offcanvas-start">
            <ul class="mynav nav nav-pills flex-column">
                <li class="nav-item">
                    <a href="~/">
                        <i class="fa-solid fa-house"></i>
                        <span class="nav-label">Home</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="~/Summary/index">
                        <i class="fa-solid fa-chart-pie"></i>
                        <span class="nav-label">Summary</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="~/Perfomance/index">
                        <i class="fa-solid fa-chart-line"></i>
                        <span class="nav-label">Performance</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="~/Quality/index">
                        <i class="fa-solid fa-check-circle"></i>
                        <span class="nav-label">Quality</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="~/LossTime/index">
                        <i class="fa-solid fa-hourglass-half"></i>
                        <span class="nav-label">Trend Loss<br>Time</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="~/LossTimeReport/index">
                        <i class="fa-solid fa-file-lines"></i>
                        <span class="nav-label">Detail Loss<br>Time</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="~/ProductionReport/index">
                        <i class="fa-solid fa-industry"></i>
                        <span class="nav-label">Production<br>Achievement</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" data-bs-toggle="modal" data-bs-target="#breakTimeFilterModal">
                        <i class="fa-solid fa-clock"></i>
                        <span class="nav-label">Break Time</span>
                    </a>
                </li>

                <!-- MORE MENU -->
        <li class="nav-item" style="position: relative;">
            <a href="#" id="moreMenuBtn">
                <i class="fa-solid fa-ellipsis-vertical"></i>
                <span class="nav-label">More</span>
            </a>

            <!-- POPUP MENU -->
            <div id="moreMenuPopup" style="display: none; position: absolute; left: 100%; top: 0; margin-left: 8px; background: rgba(255, 255, 255, 0.95); border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); min-width: 140px; z-index: 1000;">
                <a href="~/Final/ProductionPlan" style="display: flex; align-items: center; gap: 8px; padding: 10px 12px; color: #333; text-decoration: none; border-bottom: 1px solid rgba(0,0,0,0.1);">
                    <i class="fa-solid fa-clipboard-list" style="font-size: 14px;"></i>
                    <span style="font-size: 11px; white-space: nowrap;">CS Plan</span>
                </a>
                <a href="~/Final/ProductionPlan" style="display: flex; align-items: center; gap: 8px; padding: 10px 12px; color: #333; text-decoration: none;">
                    <i class="fa-solid fa-tasks" style="font-size: 14px;"></i>
                    <span style="font-size: 11px; white-space: nowrap;">CU Plan</span>
                </a>
            </div>
        </li>
         </ul>

<div class="align-items-center center">
    <form method="post"
          asp-area="Identity"
          asp-page="/Account/Logout"
          asp-route-returnUrl="@Url.Page("/Index", new { area = "" })">
        <button type="submit" class="logout-btn">
            <i class="fa-solid fa-right-from-bracket"></i>
            <span class="nav-label">Log Out</span>
        </button>
    </form>
</div>


        </div>

        <div class="main-content-wrapper">
            <div class="p-4">
                <main role="main" class="pb-5">
                    @RenderBody()
                </main>
            </div>
        </div>
    </div>

    <div class="footer-copyright text-white text-center">
        <p class="m-0 opacity-75">&copy; 2025 - Panasonic Manufacturing Indonesia (PMI) - AC BU</p>
    </div>

    <div class="modal fade" id="breakTimeFilterModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background: linear-gradient(180deg, #2d3548 0%, #1f2533 100%); border: 1px solid rgba(255,255,255,0.2); border-radius: 15px;">
                <div class="modal-header border-bottom border-secondary">
                    <h5 class="modal-title text-white fw-bold">
                        <i class="fa-solid fa-clock me-2"></i>Break Time Settings
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    @{
                        var models = new MonitoringSystem.Pages.Shared.ApplyBreakFilterModel(
                            (ApplicationDbContext)Context.RequestServices.GetService(typeof(ApplicationDbContext)));
                        await models.LoadBreakTimesAsync();
                        await Html.RenderPartialAsync("_BreakTimeFilterPartial", models);
                    }
                </div>
            </div>
        </div>
    </div>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

    <script>
$(document).ready(function () {
    var currentPath = window.location.pathname.toLowerCase();

    // Hapus semua active dulu
    $('#bdSidebar .nav-item a').removeClass('active');

    // Cek tiap link
    $('#bdSidebar .nav-item a').each(function() {
        var linkPath = $(this).attr('href');

        // Skip kalau link modal
        if (!linkPath || linkPath === '#') return;

        // Bersihkan path
        var cleanLink = linkPath.toLowerCase().replace('~/', '/');

        // Khusus untuk home page
        if (cleanLink === '/' && (currentPath === '/' || currentPath === '/index')) {
            $(this).addClass('active');
            return;
        }

        // Untuk halaman lainnya, cek apakah URL mengandung nama halaman
        var pageName = cleanLink.split('/').filter(x => x && x !== 'index')[0];

        if (pageName && currentPath.includes(pageName)) {
            $(this).addClass('active');
        }
    });
});
</script>

    <script>
        function updateDateTime() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('id-ID', { day: '2-digit', month: '2-digit', year: 'numeric' }).replace(/\//g, '.');
            const timeStr = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false });
            document.getElementById('current-date').textContent = dateStr;
            document.getElementById('current-time').textContent = timeStr;
        }
        $(document).ready(function () {
            updateDateTime();
            setInterval(updateDateTime, 1000);
        });
    </script>
    <script>
    // More Menu Toggle
    document.addEventListener('DOMContentLoaded', function() {
        const moreBtn = document.getElementById('moreMenuBtn');
        const morePopup = document.getElementById('moreMenuPopup');

        if (moreBtn && morePopup) {
            moreBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();

                if (morePopup.style.display === 'none') {
                    morePopup.style.display = 'block';
                } else {
                    morePopup.style.display = 'none';
                }
            });

            // Close popup when clicking outside
            document.addEventListener('click', function(e) {
                if (!moreBtn.contains(e.target) && !morePopup.contains(e.target)) {
                    morePopup.style.display = 'none';
                }
            });
        }
    });
</script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>