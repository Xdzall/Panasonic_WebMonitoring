@page
@using System.Globalization
@using MonitoringSystem.Pages.Summary
@model MonitoringSystem.Pages.Summary.SummaryModel
@{
    ViewData["Title"] = "Production Summary";

    // ==========================================================================================
    // BAGIAN 1: INISIALISASI VARIABEL AKUMULATOR
    // ==========================================================================================
    #region Initializing Accumulators
    // Akumulator Shift 1
    long PlanCUShift_01_Range = 0, TotalActualCUShift_01_Range = 0, TotalDefectCUShift_01_Qty_Range = 0, ModelChangesCUShift_01_Range = 0;
    long PlanCSShift_01_Range = 0, TotalActualCSShift_01_Range = 0, TotalDefectCSShift_01_Qty_Range = 0, ModelChangesCSShift_01_Range = 0;
    double WorkingTimeElapsed_01_Range = 0, ModelTimeChangeCUShift_01_Range = 0, ModelTimeChangeCSShift_01_Range = 0, TotalLossTimeCUShift_01_Range = 0, TotalLossTimeCSShift_01_Range = 0;
    DateTime? ModelStartTimeCUShift_01 = null, ModelEndTimeCUShift_01 = null, ModelStartTimeCSShift_01 = null, ModelEndTimeCSShift_01 = null;

    // Akumulator Shift 2
    long PlanCUShift_02_Range = 0, TotalActualCUShift_02_Range = 0, TotalDefectCUShift_02_Qty_Range = 0, ModelChangesCUShift_02_Range = 0;
    long PlanCSShift_02_Range = 0, TotalActualCSShift_02_Range = 0, TotalDefectCSShift_02_Qty_Range = 0, ModelChangesCSShift_02_Range = 0;
    double WorkingTimeElapsed_02_Range = 0, ModelTimeChangeCUShift_02_Range = 0, ModelTimeChangeCSShift_02_Range = 0, TotalLossTimeCUShift_02_Range = 0, TotalLossTimeCSShift_02_Range = 0;
    DateTime? ModelStartTimeCUShift_02 = null, ModelEndTimeCUShift_02 = null, ModelStartTimeCSShift_02 = null, ModelEndTimeCSShift_02 = null;

    // Akumulator Shift 3
    long PlanCUShift_03_Range = 0, TotalActualCUShift_03_Range = 0, TotalDefectCUShift_03_Qty_Range = 0, ModelChangesCUShift_03_Range = 0;
    long PlanCSShift_03_Range = 0, TotalActualCSShift_03_Range = 0, TotalDefectCSShift_03_Qty_Range = 0, ModelChangesCSShift_03_Range = 0;
    double WorkingTimeElapsed_03_Range = 0, ModelTimeChangeCUShift_03_Range = 0, ModelTimeChangeCSShift_03_Range = 0, TotalLossTimeCUShift_03_Range = 0, TotalLossTimeCSShift_03_Range = 0;
    DateTime? ModelStartTimeCUShift_03 = null, ModelEndTimeCUShift_03 = null, ModelStartTimeCSShift_03 = null, ModelEndTimeCSShift_03 = null;

    int workingDaysInRange = 0;
    double pph_CU_02 = 0, pph_CS_02 = 0;
    double pph_CU_03 = 0, pph_CS_03 = 0;

    long PlanCUShift_01_Base = 0;
    long PlanCSShift_01_Base = 0;

    long PlanCUShift_02_Base = 0;
    long PlanCSShift_02_Base = 0;

    #endregion


    // ==========================================================================================
    // BAGIAN 2: LOOPING DAN AKUMULASI DATA HARIAN
    // ==========================================================================================
    for (var day = Model.StartSelectedDate.Date; day <= Model.EndSelectedDate.Date; day = day.AddDays(1))
    {
        var dayType = Model.DetermineTypeOfDay(day.DayOfWeek);
        if (dayType == "WEEKEND") continue;
        workingDaysInRange++;

        var now = DateTime.Now;
        #region Shift 1 Calculations
        // 1. Definisi waktu (Disamakan dengan Production Report)
        var StartWorkingTimeShift_01 = new TimeSpan(7, 5, 0);
        var EndWorkingTimeShift_01 = new TimeSpan(15, 55, 0);
        var StartDateTimeShift_01 = day + StartWorkingTimeShift_01;
        var EndDateTimeShift_01 = day + EndWorkingTimeShift_01;

        // ✅ Ambil plan sesuai waktu shift 1
        var planDataShift_01 = Model.GetPlanFromTargetUnit(StartDateTimeShift_01, EndDateTimeShift_01);
        var listRestTimeShift_01 = Model.GetRestTime(dayType);
        var totalNetWorkingMinutes_01 = (EndWorkingTimeShift_01 - StartWorkingTimeShift_01).TotalMinutes - listRestTimeShift_01.Sum(r => (r.EndTime - r.StartTime).TotalMinutes);

        //base plan shift 1
        var planCU_01 = Convert.ToInt64(
        planDataShift_01.FirstOrDefault(p => p.MachineCode == "MCH1-01")?.Quantity ?? 0);

        var planCS_01 = Convert.ToInt64(
            planDataShift_01.FirstOrDefault(p => p.MachineCode == "MCH1-02")?.Quantity ?? 0);

        // plan tetap
        PlanCUShift_01_Range += planCU_01;
        PlanCSShift_01_Range += planCS_01;

        // simpan sebagai pembanding
        PlanCUShift_01_Base += planCU_01;
        PlanCSShift_01_Base += planCS_01;


        // 2. Ambil data aktual DULU
        var actualDataShift_01 = Model.GetActualData(StartDateTimeShift_01, EndDateTimeShift_01);
        var totalDefectShift_01 = Model.GetTotalDefect(StartDateTimeShift_01, EndDateTimeShift_01);

        // 3. Hitung waktu kerja yang berlalu
        var workingTimeElapsedForDay_01 = Model.CalculateSingleDayElapsedWorkingTime(day, StartWorkingTimeShift_01, EndWorkingTimeShift_01, listRestTimeShift_01);

        // 4. Periksa produksi & terapkan aturan bisnis SEBELUM MENAMBAHKAN KE TOTAL
        var dailyActual_01 = (actualDataShift_01.FirstOrDefault(p => p.MachineCode == "MCH1-01")?.Quantity ?? 0) +
                             (actualDataShift_01.FirstOrDefault(p => p.MachineCode == "MCH1-02")?.Quantity ?? 0);
        if (dailyActual_01 == 0)
        {
            workingTimeElapsedForDay_01 = 0; // Atur ulang jadi 0 jika tidak ada produksi
        }

        // 5. Setelah diperiksa, BARU tambahkan ke total
        WorkingTimeElapsed_01_Range += workingTimeElapsedForDay_01;

        // PlanCUShift_01_Range += (long)(workingTimeElapsedForDay_01 * ((totalNetWorkingMinutes_01 > 0) ? (double)(Model.PlanData.FirstOrDefault(p => p.MachineCode == "MCH1-01")?.Quantity ?? 0) / (totalNetWorkingMinutes_01 * workingDaysInRange) : 0));
        // PlanCUShift_01_Range += Convert.ToInt64(planDataShift_01.FirstOrDefault(p => p.MachineCode == "MCH1-01")?.Quantity ?? 0);
        TotalActualCUShift_01_Range += actualDataShift_01.FirstOrDefault(p => p.MachineCode == "MCH1-01")?.Quantity ?? 0;
        TotalLossTimeCUShift_01_Range += Model.CalculateTotalLossTime("MCH1-01", StartDateTimeShift_01, EndDateTimeShift_01, listRestTimeShift_01);
        TotalDefectCUShift_01_Qty_Range += totalDefectShift_01.FirstOrDefault(p => p.MachineCode == "MCH1-01")?.DefectQty ?? 0;
        ModelChangesCUShift_01_Range += Model.GetTotalChangeModel("MCH1-01", StartDateTimeShift_01, EndDateTimeShift_01);
        var modelDataCU_01 = Model.GetStartEndModel("MCH1-01", StartDateTimeShift_01, EndDateTimeShift_01);
        ModelTimeChangeCUShift_01_Range += modelDataCU_01.Count > 1 ? modelDataCU_01.Zip(modelDataCU_01.Skip(1), (p, n) => (n.StartTime - p.EndTime).TotalMinutes).Sum() : 0.0;
        if (modelDataCU_01.Any() && ModelStartTimeCUShift_01 == null) { ModelStartTimeCUShift_01 = modelDataCU_01.First().StartTime; }
        if (modelDataCU_01.Any()) { ModelEndTimeCUShift_01 = modelDataCU_01.Last().EndTime; }

        // PlanCSShift_01_Range += (long)(workingTimeElapsedForDay_01 * ((totalNetWorkingMinutes_01 > 0) ? (double)(Model.PlanData.FirstOrDefault(p => p.MachineCode == "MCH1-02")?.Quantity ?? 0) / (totalNetWorkingMinutes_01 * workingDaysInRange) : 0));
        // PlanCSShift_01_Range += Convert.ToInt64(planDataShift_01.FirstOrDefault(p => p.MachineCode == "MCH1-02")?.Quantity ?? 0);
        TotalActualCSShift_01_Range += actualDataShift_01.FirstOrDefault(p => p.MachineCode == "MCH1-02")?.Quantity ?? 0;
        TotalLossTimeCSShift_01_Range += Model.CalculateTotalLossTime("MCH1-02", StartDateTimeShift_01, EndDateTimeShift_01, listRestTimeShift_01);
        TotalDefectCSShift_01_Qty_Range += totalDefectShift_01.FirstOrDefault(p => p.MachineCode == "MCH1-02")?.DefectQty ?? 0;
        ModelChangesCSShift_01_Range += Model.GetTotalChangeModel("MCH1-02", StartDateTimeShift_01, EndDateTimeShift_01);
        var modelDataCS_01 = Model.GetStartEndModel("MCH1-02", StartDateTimeShift_01, EndDateTimeShift_01);
        ModelTimeChangeCSShift_01_Range += modelDataCS_01.Count > 1 ? modelDataCS_01.Zip(modelDataCS_01.Skip(1), (p, n) => (n.StartTime - p.EndTime).TotalMinutes).Sum() : 0.0;
        if (modelDataCS_01.Any() && ModelStartTimeCSShift_01 == null) { ModelStartTimeCSShift_01 = modelDataCS_01.First().StartTime; }
        if (modelDataCS_01.Any()) { ModelEndTimeCSShift_01 = modelDataCS_01.Last().EndTime; }
        #endregion

        #region Shift 2 Calculations
        // 1. Definisi waktu
        var StartWorkingTimeShift_02 = new TimeSpan(16, 0, 0);
        var EndWorkingTimeShift_02 = new TimeSpan(23, 15, 0);
        var StartDateTimeShift_02 = day + StartWorkingTimeShift_02;
        var EndDateTimeShift_02 = day + EndWorkingTimeShift_02;

        // ✅ Plan khusus shift 2
        var planDataShift_02 = Model.GetPlanFromTargetUnit(StartDateTimeShift_02, EndDateTimeShift_02);
        var rawPlanCU_02 = Convert.ToInt64(
        planDataShift_02.FirstOrDefault(p => p.MachineCode == "MCH1-01")?.Quantity ?? 0);

        var rawPlanCS_02 = Convert.ToInt64(
            planDataShift_02.FirstOrDefault(p => p.MachineCode == "MCH1-02")?.Quantity ?? 0);

        // 🔥 SHIFT 2 = SHIFT 2 - SHIFT 1
        var finalPlanCU_02 = Math.Max(0, rawPlanCU_02 - PlanCUShift_01_Base);
        var finalPlanCS_02 = Math.Max(0, rawPlanCS_02 - PlanCSShift_01_Base);

        PlanCUShift_02_Range += finalPlanCU_02;
        PlanCSShift_02_Range += finalPlanCS_02;

        // simpan untuk pembanding shift 3
        PlanCUShift_02_Base += finalPlanCU_02;
        PlanCSShift_02_Base += finalPlanCS_02;


        var listRestTimeShift_02 = Model.GetRestTime(dayType);
        var totalNetWorkingMinutes_02 = (EndWorkingTimeShift_02 - StartWorkingTimeShift_02).TotalMinutes - listRestTimeShift_02.Sum(r => (r.EndTime - r.StartTime).TotalMinutes);

        // 2. Ambil data aktual DULU
        var actualDataShift_02 = Model.GetActualData(StartDateTimeShift_02, EndDateTimeShift_02);
        var totalDefectShift_02 = Model.GetTotalDefect(StartDateTimeShift_02, EndDateTimeShift_02);

        // 3. Hitung waktu kerja yang berlalu
        var workingTimeElapsedForDay_02 = Model.CalculateSingleDayElapsedWorkingTime(day, StartWorkingTimeShift_02, EndWorkingTimeShift_02, listRestTimeShift_02);

        // 4. Periksa produksi & terapkan aturan bisnis SEBELUM MENAMBAHKAN KE TOTAL
        var dailyActual_02 = (actualDataShift_02.FirstOrDefault(p => p.MachineCode == "MCH1-01")?.Quantity ?? 0) +
                             (actualDataShift_02.FirstOrDefault(p => p.MachineCode == "MCH1-02")?.Quantity ?? 0);
        if (dailyActual_02 == 0)
        {
            workingTimeElapsedForDay_02 = 0;
        }

        // 5. Setelah diperiksa, BARU tambahkan ke total
        WorkingTimeElapsed_02_Range += workingTimeElapsedForDay_02;

        // PlanCUShift_02_Range += (long)(workingTimeElapsedForDay_02 * ((totalNetWorkingMinutes_02 > 0) ? (double)(Model.PlanData.FirstOrDefault(p => p.MachineCode == "MCH1-01")?.Quantity ?? 0) / (totalNetWorkingMinutes_02 * workingDaysInRange) : 0));
        // PlanCUShift_02_Range += Convert.ToInt64(planDataShift_02.FirstOrDefault(p => p.MachineCode == "MCH1-01")?.Quantity ?? 0);
        TotalActualCUShift_02_Range += actualDataShift_02.FirstOrDefault(p => p.MachineCode == "MCH1-01")?.Quantity ?? 0;
        TotalLossTimeCUShift_02_Range += Model.CalculateTotalLossTime("MCH1-01", StartDateTimeShift_02, EndDateTimeShift_02, listRestTimeShift_02);
        TotalDefectCUShift_02_Qty_Range += totalDefectShift_02.FirstOrDefault(p => p.MachineCode == "MCH1-01")?.DefectQty ?? 0;
        ModelChangesCUShift_02_Range += Model.GetTotalChangeModel("MCH1-01", StartDateTimeShift_02, EndDateTimeShift_02);
        var modelDataCU_02 = Model.GetStartEndModel("MCH1-01", StartDateTimeShift_02, EndDateTimeShift_02);
        ModelTimeChangeCUShift_02_Range += modelDataCU_02.Count > 1 ? modelDataCU_02.Zip(modelDataCU_02.Skip(1), (p, n) => (n.StartTime - p.EndTime).TotalMinutes).Sum() : 0.0;
        if (modelDataCU_02.Any() && ModelStartTimeCUShift_02 == null) { ModelStartTimeCUShift_02 = modelDataCU_02.First().StartTime; }
        if (modelDataCU_02.Any()) { ModelEndTimeCUShift_02 = modelDataCU_02.Last().EndTime; }

        // PlanCSShift_02_Range += (long)(workingTimeElapsedForDay_02 * ((totalNetWorkingMinutes_02 > 0) ? (double)(Model.PlanData.FirstOrDefault(p => p.MachineCode == "MCH1-02")?.Quantity ?? 0) / (totalNetWorkingMinutes_02 * workingDaysInRange) : 0));
        // PlanCSShift_02_Range += Convert.ToInt64(planDataShift_02.FirstOrDefault(p => p.MachineCode == "MCH1-02")?.Quantity ?? 0);
        TotalActualCSShift_02_Range += actualDataShift_02.FirstOrDefault(p => p.MachineCode == "MCH1-02")?.Quantity ?? 0;
        TotalLossTimeCSShift_02_Range += Model.CalculateTotalLossTime("MCH1-02", StartDateTimeShift_02, EndDateTimeShift_02, listRestTimeShift_02);
        TotalDefectCSShift_02_Qty_Range += totalDefectShift_02.FirstOrDefault(p => p.MachineCode == "MCH1-02")?.DefectQty ?? 0;
        ModelChangesCSShift_02_Range += Model.GetTotalChangeModel("MCH1-02", StartDateTimeShift_02, EndDateTimeShift_02);
        var modelDataCS_02 = Model.GetStartEndModel("MCH1-02", StartDateTimeShift_02, EndDateTimeShift_02);
        ModelTimeChangeCSShift_02_Range += modelDataCS_02.Count > 1 ? modelDataCS_02.Zip(modelDataCS_02.Skip(1), (p, n) => (n.StartTime - p.EndTime).TotalMinutes).Sum() : 0.0;
        if (modelDataCS_02.Any() && ModelStartTimeCSShift_02 == null) { ModelStartTimeCSShift_02 = modelDataCS_02.First().StartTime; }
        if (modelDataCS_02.Any()) { ModelEndTimeCSShift_02 = modelDataCS_02.Last().EndTime; }
        #endregion

        #region Shift 3 Calculations
        // 1. Definisi waktu
        var StartWorkingTimeShift_03 = new TimeSpan(23, 15, 0);
        var EndWorkingTimeShift_03 = new TimeSpan(7, 0, 0);
        var StartDateTimeShift_03 = day + StartWorkingTimeShift_03;
        var EndDateTimeShift_03 = day.AddDays(1) + EndWorkingTimeShift_03;

        // ✅ Plan khusus shift 3
        var planDataShift_03 = Model.GetPlanFromTargetUnit(StartDateTimeShift_03, EndDateTimeShift_03);
        var rawPlanCU_03 = Convert.ToInt64(
        planDataShift_03.FirstOrDefault(p => p.MachineCode == "MCH1-01")?.Quantity ?? 0);

        var rawPlanCS_03 = Convert.ToInt64(
            planDataShift_03.FirstOrDefault(p => p.MachineCode == "MCH1-02")?.Quantity ?? 0);

        // 🔥 SHIFT 3 = SHIFT 3 - SHIFT 2
        var finalPlanCU_03 = Math.Max(0, rawPlanCU_03 - PlanCUShift_02_Base);
        var finalPlanCS_03 = Math.Max(0, rawPlanCS_03 - PlanCSShift_02_Base);

        PlanCUShift_03_Range += finalPlanCU_03;
        PlanCSShift_03_Range += finalPlanCS_03;


        var listRestTimeShift_03 = Model.GetRestTime(dayType);
        var totalNetWorkingMinutes_03 = (EndDateTimeShift_03 - StartDateTimeShift_03).TotalMinutes;

        // 2. Ambil data aktual DULU
        var actualDataShift_03 = Model.GetActualData(StartDateTimeShift_03, EndDateTimeShift_03);
        var totalDefectShift_03 = Model.GetTotalDefect(StartDateTimeShift_03, EndDateTimeShift_03);

        // 3. Hitung waktu kerja yang berlalu
        var workingTimeElapsedForDay_03 = Model.CalculateOvernightShiftElapsedWorkingTime(day, StartWorkingTimeShift_03, EndWorkingTimeShift_03, listRestTimeShift_03);

        // 4. Periksa produksi & terapkan aturan bisnis SEBELUM MENAMBAHKAN KE TOTAL
        var dailyActual_03 = (actualDataShift_03.FirstOrDefault(p => p.MachineCode == "MCH1-01")?.Quantity ?? 0) +
                             (actualDataShift_03.FirstOrDefault(p => p.MachineCode == "MCH1-02")?.Quantity ?? 0);
        if (dailyActual_03 == 0)
        {
            workingTimeElapsedForDay_03 = 0;
        }

        // 5. Setelah diperiksa, BARU tambahkan ke total
        WorkingTimeElapsed_03_Range += workingTimeElapsedForDay_03;

        // PlanCUShift_03_Range += (long)(workingTimeElapsedForDay_03 * ((totalNetWorkingMinutes_03 > 0) ? (double)(Model.PlanData.FirstOrDefault(p => p.MachineCode == "MCH1-01")?.Quantity ?? 0) / (totalNetWorkingMinutes_03 * workingDaysInRange) : 0));
        // PlanCUShift_03_Range += Convert.ToInt64(planDataShift_03.FirstOrDefault(p => p.MachineCode == "MCH1-01")?.Quantity ?? 0);
        TotalActualCUShift_03_Range += actualDataShift_03.FirstOrDefault(p => p.MachineCode == "MCH1-01")?.Quantity ?? 0;
        TotalLossTimeCUShift_03_Range += Model.CalculateTotalLossTime("MCH1-01", StartDateTimeShift_03, EndDateTimeShift_03, listRestTimeShift_03);
        TotalDefectCUShift_03_Qty_Range += totalDefectShift_03.FirstOrDefault(p => p.MachineCode == "MCH1-01")?.DefectQty ?? 0;
        ModelChangesCUShift_03_Range += Model.GetTotalChangeModel("MCH1-01", StartDateTimeShift_03, EndDateTimeShift_03);
        var modelDataCU_03 = Model.GetStartEndModel("MCH1-01", StartDateTimeShift_03, EndDateTimeShift_03);
        ModelTimeChangeCUShift_03_Range += modelDataCU_03.Count > 1 ? modelDataCU_03.Zip(modelDataCU_03.Skip(1), (p, n) => (n.StartTime - p.EndTime).TotalMinutes).Sum() : 0.0;
        if (modelDataCU_03.Any() && ModelStartTimeCUShift_03 == null) { ModelStartTimeCUShift_03 = modelDataCU_03.First().StartTime; }
        if (modelDataCU_03.Any()) { ModelEndTimeCUShift_03 = modelDataCU_03.Last().EndTime; }

        // PlanCSShift_03_Range += (long)(workingTimeElapsedForDay_03 * ((totalNetWorkingMinutes_03 > 0) ? (double)(Model.PlanData.FirstOrDefault(p => p.MachineCode == "MCH1-02")?.Quantity ?? 0) / (totalNetWorkingMinutes_03 * workingDaysInRange) : 0));
        // PlanCSShift_03_Range += Convert.ToInt64(planDataShift_03.FirstOrDefault(p => p.MachineCode == "MCH1-02")?.Quantity ?? 0);
        TotalActualCSShift_03_Range += actualDataShift_03.FirstOrDefault(p => p.MachineCode == "MCH1-02")?.Quantity ?? 0;
        TotalLossTimeCSShift_03_Range += Model.CalculateTotalLossTime("MCH1-02", StartDateTimeShift_03, EndDateTimeShift_03, listRestTimeShift_03);
        TotalDefectCSShift_03_Qty_Range += totalDefectShift_03.FirstOrDefault(p => p.MachineCode == "MCH1-02")?.DefectQty ?? 0;
        ModelChangesCSShift_03_Range += Model.GetTotalChangeModel("MCH1-02", StartDateTimeShift_03, EndDateTimeShift_03);
        var modelDataCS_03 = Model.GetStartEndModel("MCH1-02", StartDateTimeShift_03, EndDateTimeShift_03);
        ModelTimeChangeCSShift_03_Range += modelDataCS_03.Count > 1 ? modelDataCS_03.Zip(modelDataCS_03.Skip(1), (p, n) => (n.StartTime - p.EndTime).TotalMinutes).Sum() : 0.0;
        if (modelDataCS_03.Any() && ModelStartTimeCSShift_03 == null) { ModelStartTimeCSShift_03 = modelDataCS_03.First().StartTime; }
        if (modelDataCS_03.Any()) { ModelEndTimeCSShift_03 = modelDataCS_03.Last().EndTime; }
        #endregion
    }

    // ==========================================================================================
    // BAGIAN 3: KALKULASI FINAL DAN PERSIAPAN DISPLAY
    // ==========================================================================================

    #region Shift 1 Final Calculations
    // var DailyPlanCUShift_01 = (Model.PlanData.FirstOrDefault(p => p.MachineCode == "MCH1-01")?.Quantity ?? 0);
    var dailyPlanData = Model.GetDailyPlanData(Model.StartSelectedDate, Model.EndSelectedDate.AddDays(1));
    var DailyPlanCUShift_01 = dailyPlanData.FirstOrDefault(p => p.MachineCode == "MCH1-01")?.Quantity ?? 0;
    var DiffCUShift_01 = TotalActualCUShift_01_Range - PlanCUShift_01_Range;
    var OprRatioCUShift_01 = (WorkingTimeElapsed_01_Range > 0) ? Math.Round(((WorkingTimeElapsed_01_Range - TotalLossTimeCUShift_01_Range) / WorkingTimeElapsed_01_Range) * 100, 2) : 100.0;
    var WorkEffCUShift_01 = (PlanCUShift_01_Range > 0) ? Math.Round(((double)TotalActualCUShift_01_Range / PlanCUShift_01_Range) * 100, 2) : 0;
    var DefectRatioCUShift_01 = (TotalActualCUShift_01_Range + TotalDefectCUShift_01_Qty_Range > 0) ? (1 - ((double)TotalDefectCUShift_01_Qty_Range / (TotalActualCUShift_01_Range + TotalDefectCUShift_01_Qty_Range))) * 100 : 100.0;
    var TotalEffCUShift_01 = Math.Round((OprRatioCUShift_01 / 100) * (WorkEffCUShift_01 / 100) * (DefectRatioCUShift_01 / 100) * 100, 2);

    // var DailyPlanCSShift_01 = (Model.PlanData.FirstOrDefault(p => p.MachineCode == "MCH1-02")?.Quantity ?? 0);
    var DailyPlanCSShift_01 = dailyPlanData.FirstOrDefault(p => p.MachineCode == "MCH1-02")?.Quantity ?? 0;
    var DiffCSShift_01 = TotalActualCSShift_01_Range - PlanCSShift_01_Range;
    var OprRatioCSShift_01 = (WorkingTimeElapsed_01_Range > 0) ? Math.Round(((WorkingTimeElapsed_01_Range - TotalLossTimeCSShift_01_Range) / WorkingTimeElapsed_01_Range) * 100, 2) : 100.0;
    var WorkEffCSShift_01 = (PlanCSShift_01_Range > 0) ? Math.Round(((double)TotalActualCSShift_01_Range / PlanCSShift_01_Range) * 100, 2) : 0;
    var DefectRatioCSShift_01 = (TotalActualCSShift_01_Range + TotalDefectCSShift_01_Qty_Range > 0) ? (1 - ((double)TotalDefectCSShift_01_Qty_Range / (TotalActualCSShift_01_Range + TotalDefectCSShift_01_Qty_Range))) * 100 : 100.0;
    var TotalEffCSShift_01 = Math.Round((OprRatioCSShift_01 / 100) * (WorkEffCSShift_01 / 100) * (DefectRatioCSShift_01 / 100) * 100, 2);

    // --- Perhitungan P/H/H untuk Shift 1 ---
    var workers_CU_01 = Model.GetAverageWorkersForPeriod("MCH1-01", Model.StartSelectedDate, Model.EndSelectedDate.AddDays(1));
    var netProductiveMinutes_CU_01 = WorkingTimeElapsed_01_Range - TotalLossTimeCUShift_01_Range;
    var netProductiveHours_CU_01 = netProductiveMinutes_CU_01 > 0 ? netProductiveMinutes_CU_01 / 60.0 : 0;
    double pph_CU_01 = 0;
    if (TotalActualCUShift_01_Range > 0 && workers_CU_01 > 0 && netProductiveHours_CU_01 > 0)
    {
        pph_CU_01 = Math.Round(TotalActualCUShift_01_Range / (double)workers_CU_01 / netProductiveHours_CU_01, 2);
    }

    var workers_CS_01 = Model.GetAverageWorkersForPeriod("MCH1-02", Model.StartSelectedDate, Model.EndSelectedDate.AddDays(1));
    var netProductiveMinutes_CS_01 = WorkingTimeElapsed_01_Range - TotalLossTimeCSShift_01_Range;
    var netProductiveHours_CS_01 = netProductiveMinutes_CS_01 > 0 ? netProductiveMinutes_CS_01 / 60.0 : 0;
    double pph_CS_01 = 0;
    if (TotalActualCSShift_01_Range > 0 && workers_CS_01 > 0 && netProductiveHours_CS_01 > 0)
    {
        pph_CS_01 = Math.Round(TotalActualCSShift_01_Range / (double)workers_CS_01 / netProductiveHours_CS_01, 2);
    }
    #endregion

    #region Shift 2 Final Calculations
    // var DailyPlanCUShift_02 = (Model.PlanData.FirstOrDefault(p => p.MachineCode == "MCH1-01")?.Quantity ?? 0);
    var DailyPlanCUShift_02 = dailyPlanData.FirstOrDefault(p => p.MachineCode == "MCH1-01")?.Quantity ?? 0;
    var DiffCUShift_02 = TotalActualCUShift_02_Range - PlanCUShift_02_Range;
    var OprRatioCUShift_02 = (WorkingTimeElapsed_02_Range > 0) ? Math.Round(((WorkingTimeElapsed_02_Range - TotalLossTimeCUShift_02_Range) / WorkingTimeElapsed_02_Range) * 100, 2) : 100.0;
    var WorkEffCUShift_02 = (PlanCUShift_02_Range > 0) ? Math.Round(((double)TotalActualCUShift_02_Range / PlanCUShift_02_Range) * 100, 2) : 0;
    var DefectRatioCUShift_02 = (TotalActualCUShift_02_Range + TotalDefectCUShift_02_Qty_Range > 0) ? (1 - ((double)TotalDefectCUShift_02_Qty_Range / (TotalActualCUShift_02_Range + TotalDefectCUShift_02_Qty_Range))) * 100 : 100.0;
    var TotalEffCUShift_02 = Math.Round((OprRatioCUShift_02 / 100) * (WorkEffCUShift_02 / 100) * (DefectRatioCUShift_02 / 100) * 100, 2);

    // var DailyPlanCSShift_02 = (Model.PlanData.FirstOrDefault(p => p.MachineCode == "MCH1-02")?.Quantity ?? 0);
    var DailyPlanCSShift_02 = dailyPlanData.FirstOrDefault(p => p.MachineCode == "MCH1-02")?.Quantity ?? 0;
    var DiffCSShift_02 = TotalActualCSShift_02_Range - PlanCSShift_02_Range;
    var OprRatioCSShift_02 = (WorkingTimeElapsed_02_Range > 0) ? Math.Round(((WorkingTimeElapsed_02_Range - TotalLossTimeCSShift_02_Range) / WorkingTimeElapsed_02_Range) * 100, 2) : 100.0;
    var WorkEffCSShift_02 = (PlanCSShift_02_Range > 0) ? Math.Round(((double)TotalActualCSShift_02_Range / PlanCSShift_02_Range) * 100, 2) : 0;
    var DefectRatioCSShift_02 = (TotalActualCSShift_02_Range + TotalDefectCSShift_02_Qty_Range > 0) ? (1 - ((double)TotalDefectCSShift_02_Qty_Range / (TotalActualCSShift_02_Range + TotalDefectCSShift_02_Qty_Range))) * 100 : 100.0;
    var TotalEffCSShift_02 = Math.Round((OprRatioCSShift_02 / 100) * (WorkEffCSShift_02 / 100) * (DefectRatioCSShift_02 / 100) * 100, 2);

    // --- Perhitungan P/H/H untuk Shift 2 ---
    var workers_CU_02 = Model.GetAverageWorkersForPeriod("MCH1-01", Model.StartSelectedDate, Model.EndSelectedDate.AddDays(1));
    var netProductiveMinutes_CU_02 = WorkingTimeElapsed_02_Range - TotalLossTimeCUShift_02_Range;
    var netProductiveHours_CU_02 = netProductiveMinutes_CU_02 > 0 ? netProductiveMinutes_CU_02 / 60.0 : 0;
    if (TotalActualCUShift_02_Range > 0 && workers_CU_02 > 0 && netProductiveHours_CU_02 > 0)
    {
        pph_CU_02 = Math.Round(TotalActualCUShift_02_Range / (double)workers_CU_02 / netProductiveHours_CU_02, 2);
    }

    var workers_CS_02 = Model.GetAverageWorkersForPeriod("MCH1-02", Model.StartSelectedDate, Model.EndSelectedDate.AddDays(1));
    var netProductiveMinutes_CS_02 = WorkingTimeElapsed_02_Range - TotalLossTimeCSShift_02_Range;
    var netProductiveHours_CS_02 = netProductiveMinutes_CS_02 > 0 ? netProductiveMinutes_CS_02 / 60.0 : 0;
    if (TotalActualCSShift_02_Range > 0 && workers_CS_02 > 0 && netProductiveHours_CS_02 > 0)
    {
        pph_CS_02 = Math.Round(TotalActualCSShift_02_Range / (double)workers_CS_02 / netProductiveHours_CS_02, 2);
    }
    #endregion

    #region Shift 3 Final Calculations
    // var DailyPlanCUShift_03 = (Model.PlanData.FirstOrDefault(p => p.MachineCode == "MCH1-01")?.Quantity ?? 0);
    var DailyPlanCUShift_03 = dailyPlanData.FirstOrDefault(p => p.MachineCode == "MCH1-01")?.Quantity ?? 0;
    var DiffCUShift_03 = TotalActualCUShift_03_Range - PlanCUShift_03_Range;
    var OprRatioCUShift_03 = (WorkingTimeElapsed_03_Range > 0) ? Math.Round(((WorkingTimeElapsed_03_Range - TotalLossTimeCUShift_03_Range) / WorkingTimeElapsed_03_Range) * 100, 2) : 100.0;
    var WorkEffCUShift_03 = (PlanCUShift_03_Range > 0) ? Math.Round(((double)TotalActualCUShift_03_Range / PlanCUShift_03_Range) * 100, 2) : 0;
    var DefectRatioCUShift_03 = (TotalActualCUShift_03_Range + TotalDefectCUShift_03_Qty_Range > 0) ? (1 - ((double)TotalDefectCUShift_03_Qty_Range / (TotalActualCUShift_03_Range + TotalDefectCUShift_03_Qty_Range))) * 100 : 100.0;
    var TotalEffCUShift_03 = Math.Round((OprRatioCUShift_03 / 100) * (WorkEffCUShift_03 / 100) * (DefectRatioCUShift_03 / 100) * 100, 2);

    // var DailyPlanCSShift_03 = (Model.PlanData.FirstOrDefault(p => p.MachineCode == "MCH1-02")?.Quantity ?? 0);
    var DailyPlanCSShift_03 = dailyPlanData.FirstOrDefault(p => p.MachineCode == "MCH1-02")?.Quantity ?? 0;
    var DiffCSShift_03 = TotalActualCSShift_03_Range - PlanCSShift_03_Range;
    var OprRatioCSShift_03 = (WorkingTimeElapsed_03_Range > 0) ? Math.Round(((WorkingTimeElapsed_03_Range - TotalLossTimeCSShift_03_Range) / WorkingTimeElapsed_03_Range) * 100, 2) : 100.0;
    var WorkEffCSShift_03 = (PlanCSShift_03_Range > 0) ? Math.Round(((double)TotalActualCSShift_03_Range / PlanCSShift_03_Range) * 100, 2) : 0;
    var DefectRatioCSShift_03 = (TotalActualCSShift_03_Range + TotalDefectCSShift_03_Qty_Range > 0) ? (1 - ((double)TotalDefectCSShift_03_Qty_Range / (TotalActualCSShift_03_Range + TotalDefectCSShift_03_Qty_Range))) * 100 : 100.0;
    var TotalEffCSShift_03 = Math.Round((OprRatioCSShift_03 / 100) * (WorkEffCSShift_03 / 100) * (DefectRatioCSShift_03 / 100) * 100, 2);

    var workers_CU_03 = Model.GetAverageWorkersForPeriod("MCH1-01", Model.StartSelectedDate, Model.EndSelectedDate.AddDays(1));
    var netProductiveMinutes_CU_03 = WorkingTimeElapsed_03_Range - TotalLossTimeCUShift_03_Range;
    var netProductiveHours_CU_03 = netProductiveMinutes_CU_03 > 0 ? netProductiveMinutes_CU_03 / 60.0 : 0;
    if (TotalActualCUShift_03_Range > 0 && workers_CU_03 > 0 && netProductiveHours_CU_03 > 0)
    {
        pph_CU_03 = Math.Round(TotalActualCUShift_03_Range / (double)workers_CU_03 / netProductiveHours_CU_03, 2);
    }

    var workers_CS_03 = Model.GetAverageWorkersForPeriod("MCH1-02", Model.StartSelectedDate, Model.EndSelectedDate.AddDays(1));
    var netProductiveMinutes_CS_03 = WorkingTimeElapsed_03_Range - TotalLossTimeCSShift_03_Range;
    var netProductiveHours_CS_03 = netProductiveMinutes_CS_03 > 0 ? netProductiveMinutes_CS_03 / 60.0 : 0;
    if (TotalActualCSShift_03_Range > 0 && workers_CS_03 > 0 && netProductiveHours_CS_03 > 0)
    {
        pph_CS_03 = Math.Round(TotalActualCSShift_03_Range / (double)workers_CS_03 / netProductiveHours_CS_03, 2);
    }
    #endregion

    #region Overall Final Calculations
    var PlanCU_Overall = PlanCUShift_01_Range + PlanCUShift_02_Range + PlanCUShift_03_Range;
    var TotalActualCU_Overall = TotalActualCUShift_01_Range + TotalActualCUShift_02_Range + TotalActualCUShift_03_Range;
    var DiffCU_Overall = TotalActualCU_Overall - PlanCU_Overall;
    var TotalLossTimeCU_Overall = TotalLossTimeCUShift_01_Range + TotalLossTimeCUShift_02_Range + TotalLossTimeCUShift_03_Range;
    var WorkingTimeElapsed_Overall = WorkingTimeElapsed_01_Range + WorkingTimeElapsed_02_Range + WorkingTimeElapsed_03_Range;
    var ModelChangesCU_Overall = ModelChangesCUShift_01_Range + ModelChangesCUShift_02_Range + ModelChangesCUShift_03_Range;
    var ModelTimeChangeCU_Overall = ModelTimeChangeCUShift_01_Range + ModelTimeChangeCUShift_02_Range + ModelTimeChangeCUShift_03_Range;
    var TotalDefectCU_Overall_Qty = TotalDefectCUShift_01_Qty_Range + TotalDefectCUShift_02_Qty_Range + TotalDefectCUShift_03_Qty_Range;
    var OprRatioCU_Overall = (WorkingTimeElapsed_Overall > 0) ? Math.Round((((double)WorkingTimeElapsed_Overall - TotalLossTimeCU_Overall) / WorkingTimeElapsed_Overall) * 100, 2) : 100.0;
    var WorkEffCU_Overall = (PlanCU_Overall > 0) ? Math.Round(((double)TotalActualCU_Overall / PlanCU_Overall) * 100, 2) : 0;
    var DefectRatioCU_Overall = (TotalActualCU_Overall + TotalDefectCU_Overall_Qty > 0) ? (1 - ((double)TotalDefectCU_Overall_Qty / (TotalActualCU_Overall + TotalDefectCU_Overall_Qty))) * 100 : 100.0;
    var TotalEffCU_Overall = Math.Round((OprRatioCU_Overall / 100) * (WorkEffCU_Overall / 100) * (DefectRatioCU_Overall / 100) * 100, 2);

    var PlanCS_Overall = PlanCSShift_01_Range + PlanCSShift_02_Range + PlanCSShift_03_Range;
    var TotalActualCS_Overall = TotalActualCSShift_01_Range + TotalActualCSShift_02_Range + TotalActualCSShift_03_Range;
    var DiffCS_Overall = TotalActualCS_Overall - PlanCS_Overall;
    var TotalLossTimeCS_Overall = TotalLossTimeCSShift_01_Range + TotalLossTimeCSShift_02_Range + TotalLossTimeCSShift_03_Range;
    var ModelChangesCS_Overall = ModelChangesCSShift_01_Range + ModelChangesCSShift_02_Range + ModelChangesCSShift_03_Range;
    var ModelTimeChangeCS_Overall = ModelTimeChangeCSShift_01_Range + ModelTimeChangeCSShift_02_Range + ModelTimeChangeCSShift_03_Range;
    var TotalDefectCS_Overall_Qty = TotalDefectCSShift_01_Qty_Range + TotalDefectCSShift_02_Qty_Range + TotalDefectCSShift_03_Qty_Range;
    var OprRatioCS_Overall = (WorkingTimeElapsed_Overall > 0) ? Math.Round((((double)WorkingTimeElapsed_Overall - TotalLossTimeCS_Overall) / WorkingTimeElapsed_Overall) * 100, 2) : 100.0;
    var WorkEffCS_Overall = (PlanCS_Overall > 0) ? Math.Round(((double)TotalActualCS_Overall / PlanCS_Overall) * 100, 2) : 0;
    var DefectRatioCS_Overall = (TotalActualCS_Overall + TotalDefectCS_Overall_Qty > 0) ? (1 - ((double)TotalDefectCS_Overall_Qty / (TotalActualCS_Overall + TotalDefectCS_Overall_Qty))) * 100 : 100.0;
    var TotalEffCS_Overall = Math.Round((OprRatioCS_Overall / 100) * (WorkEffCS_Overall / 100) * (DefectRatioCS_Overall / 100) * 100, 2);
    #endregion
}

<div>
    <div class="row d-flex justify-content-between mx-3 align-items-center">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <form method="post" class="w-75">
                    <div class="form-group d-flex align-items-center gap-3">
                        <div class="d-flex gap-3 align-items-center"><label class="fw-bold fs-6">Start Date</label><input type="date" class="form-control border-dark" name="StartSelectedDate" value="@Model.StartSelectedDate.ToString("yyyy-MM-dd")" style="width:60%"></div>
                        <div class="d-flex gap-3 align-items-center"><label class="fw-bold fs-6">End Date</label><input type="date" class="form-control border-dark" name="EndSelectedDate" value="@Model.EndSelectedDate.ToString("yyyy-MM-dd")" style="width:60%"></div>
                        <button type="submit" class="btn fw-bold fs-6 text-white" style="background-color: rgb(61, 121, 176);">Search</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <hr />
    @if (Model.StartSelectedDate.Date != Model.EndSelectedDate.Date)
    {
            <p class="ms-3 fs-5 fw-bold text-secondary">@Model.StartSelectedDate.ToString("dddd, dd MMMM yyyy") - @Model.EndSelectedDate.ToString("dddd, dd MMMM yyyy")</p>
    }
    else
    {
            <p class="ms-3 fs-5 fw-bold text-secondary">@Model.StartSelectedDate.ToString("dddd, dd MMMM yyyy")</p>
    }

    <div class="w-screen">
        <div class="text-center mt-3 mx-3 table-responsive card rounded-3 p-0 m-0" id="Shift1Table">
            <table class="table overflow-hidden p-0 m-0">
                <thead>
                    <tr class="align-middle">
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Shift</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Assembly Line</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Daily Plan</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Plan</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Act</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Difference</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Loss Time (min)</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Work Time (min)</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Model Start Time</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Model End Time</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Opr. Ratio (%)</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Work Eff. (%)</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Pass Through Ratio (%)</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Total Eff. (%)</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">P/H/H</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);"># of Model Change</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Model Chg Time (min)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="border fs-5 fw-medium">1</td>
                        <td class="border fs-5 fw-medium">CU</td>
                        <td class="border fs-5 fw-medium">@DailyPlanCUShift_01</td>
                        <td class="border fs-5 fw-medium">@PlanCUShift_01_Range</td>
                        <td class="border fs-5 fw-medium">@TotalActualCUShift_01_Range</td>
                        <td class="border fs-5 fw-medium @(DiffCUShift_01 < 0 ? "text-danger" : "")">@DiffCUShift_01</td>
                        <td class="border fs-5 fw-medium">@Math.Round(TotalLossTimeCUShift_01_Range)</td>
                        <td class="border fs-5 fw-medium">@Math.Round(WorkingTimeElapsed_01_Range)</td>
                        <td class="border fs-5 fw-medium">@(ModelStartTimeCUShift_01?.ToString("HH:mm:ss") ?? "-")</td>
                        <td class="border fs-5 fw-medium">@(ModelEndTimeCUShift_01?.ToString("HH:mm:ss") ?? "-")</td>
                        <td class="border fs-5 fw-medium">@OprRatioCUShift_01.ToString("F2") %</td>
                        <td class="border fs-5 fw-medium">@WorkEffCUShift_01.ToString("F2") %</td>
                        <td class="border fs-5 fw-medium">@DefectRatioCUShift_01.ToString("F2") %</td>
                        <td class="border fs-5 fw-medium">@TotalEffCUShift_01.ToString("F2") %</td>
                        <td class="border fs-5 fw-medium">@(pph_CU_01 > 0 ? pph_CU_01.ToString("F2") : "-")</td>
                        <td class="border fs-5 fw-medium">@ModelChangesCUShift_01_Range</td>
                        <td class="border fs-5 fw-medium">@Math.Round(ModelTimeChangeCUShift_01_Range, 2)</td>
                    </tr>
                    <tr>
                        <td class="border fs-5 fw-medium">1</td>
                        <td class="border fs-5 fw-medium">CS</td>
                        <td class="border fs-5 fw-medium">@DailyPlanCSShift_01</td>
                        <td class="border fs-5 fw-medium">@PlanCSShift_01_Range</td>
                        <td class="border fs-5 fw-medium">@TotalActualCSShift_01_Range</td>
                        <td class="border fs-5 fw-medium @(DiffCSShift_01 < 0 ? "text-danger" : "")">@DiffCSShift_01</td>
                        <td class="border fs-5 fw-medium">@Math.Round(TotalLossTimeCSShift_01_Range)</td>
                        <td class="border fs-5 fw-medium">@Math.Round(WorkingTimeElapsed_01_Range)</td>
                        <td class="border fs-5 fw-medium">@(ModelStartTimeCSShift_01?.ToString("HH:mm:ss") ?? "-")</td>
                        <td class="border fs-5 fw-medium">@(ModelEndTimeCSShift_01?.ToString("HH:mm:ss") ?? "-")</td>
                        <td class="border fs-5 fw-medium">@OprRatioCSShift_01.ToString("F2") %</td>
                        <td class="border fs-5 fw-medium">@WorkEffCSShift_01.ToString("F2") %</td>
                        <td class="border fs-5 fw-medium">@DefectRatioCSShift_01.ToString("F2") %</td>
                        <td class="border fs-5 fw-medium">@TotalEffCSShift_01.ToString("F2") %</td>
                        <td class="border fs-5 fw-medium">@(pph_CS_01 > 0 ? pph_CS_01.ToString("F2") : "-")</td>
                        <td class="border fs-5 fw-medium">@ModelChangesCSShift_01_Range</td>
                        <td class="border fs-5 fw-medium">@Math.Round(ModelTimeChangeCSShift_01_Range, 2)</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="text-center mt-3 mx-3 table-responsive card rounded-3 p-0 m-0" id="Shift2Table">
            <table class="table overflow-hidden p-0 m-0">
                <thead>
                    <tr class="align-middle">
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Shift</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Assembly Line</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Daily Plan</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Plan</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Act</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Difference</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Loss Time (min)</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Work Time (min)</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Model Start Time</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Model End Time</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Opr. Ratio (%)</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Work Eff. (%)</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Pass Through Ratio (%)</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Total Eff. (%)</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">P/H/H</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);"># of Model Change</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Model Chg Time (min)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="border fs-5 fw-medium">2</td>
                        <td class="border fs-5 fw-medium">CU</td>
                        <td class="border fs-5 fw-medium">@DailyPlanCUShift_02</td>
                        <td class="border fs-5 fw-medium">@PlanCUShift_02_Range</td>
                        <td class="border fs-5 fw-medium">@TotalActualCUShift_02_Range</td>
                        <td class="border fs-5 fw-medium @(DiffCUShift_02 < 0 ? "text-danger" : "")">@DiffCUShift_02</td>
                        <td class="border fs-5 fw-medium">@Math.Round(TotalLossTimeCUShift_02_Range)</td>
                        <td class="border fs-5 fw-medium">@Math.Round(WorkingTimeElapsed_02_Range)</td>
                        <td class="border fs-5 fw-medium">@(ModelStartTimeCUShift_02?.ToString("HH:mm:ss") ?? "-")</td>
                        <td class="border fs-5 fw-medium">@(ModelEndTimeCUShift_02?.ToString("HH:mm:ss") ?? "-")</td>
                        <td class="border fs-5 fw-medium">@OprRatioCUShift_02.ToString("F2") %</td>
                        <td class="border fs-5 fw-medium">@WorkEffCUShift_02.ToString("F2") %</td>
                        <td class="border fs-5 fw-medium">@DefectRatioCUShift_02.ToString("F2") %</td>
                        <td class="border fs-5 fw-medium">@TotalEffCUShift_02.ToString("F2") %</td>
                        <td class="border fs-5 fw-medium">@(pph_CU_02 > 0 ? pph_CU_02.ToString("F2") : "-")</td>
                        <td class="border fs-5 fw-medium">@ModelChangesCUShift_02_Range</td>
                        <td class="border fs-5 fw-medium">@Math.Round(ModelTimeChangeCUShift_02_Range, 2)</td>
                    </tr>
                    <tr>
                        <td class="border fs-5 fw-medium">2</td>
                        <td class="border fs-5 fw-medium">CS</td>
                         <td class="border fs-5 fw-medium">@DailyPlanCSShift_02</td>
                        <td class="border fs-5 fw-medium">@PlanCSShift_02_Range</td>
                        <td class="border fs-5 fw-medium">@TotalActualCSShift_02_Range</td>
                        <td class="border fs-5 fw-medium @(DiffCSShift_02 < 0 ? "text-danger" : "")">@DiffCSShift_02</td>
                        <td class="border fs-5 fw-medium">@Math.Round(TotalLossTimeCSShift_02_Range)</td>
                        <td class="border fs-5 fw-medium">@Math.Round(WorkingTimeElapsed_02_Range)</td>
                        <td class="border fs-5 fw-medium">@(ModelStartTimeCSShift_02?.ToString("HH:mm:ss") ?? "-")</td>
                        <td class="border fs-5 fw-medium">@(ModelEndTimeCSShift_02?.ToString("HH:mm:ss") ?? "-")</td>
                        <td class="border fs-5 fw-medium">@OprRatioCSShift_02.ToString("F2") %</td>
                        <td class="border fs-5 fw-medium">@WorkEffCSShift_02.ToString("F2") %</td>
                        <td class="border fs-5 fw-medium">@DefectRatioCSShift_02.ToString("F2") %</td>
                        <td class="border fs-5 fw-medium">@TotalEffCSShift_02.ToString("F2") %</td>
                        <td class="border fs-5 fw-medium">@(pph_CS_02 > 0 ? pph_CS_02.ToString("F2") : "-")</td>
                        <td class="border fs-5 fw-medium">@ModelChangesCSShift_02_Range</td>
                        <td class="border fs-5 fw-medium">@Math.Round(ModelTimeChangeCSShift_02_Range, 2)</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="text-center mt-3 mx-3 table-responsive card rounded-3 p-0 m-0" id="Shift3Table">
            <table class="table overflow-hidden p-0 m-0">
                <thead>
                    <tr class="align-middle">
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Shift</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Assembly Line</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Daily Plan</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Plan</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Act</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Difference</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Loss Time (min)</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Work Time (min)</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Model Start Time</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Model End Time</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Opr. Ratio (%)</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Work Eff. (%)</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Pass Through Ratio (%)</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Total Eff. (%)</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">P/H/H</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);"># of Model Change</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Model Chg Time (min)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="border fs-5 fw-medium">3</td>
                        <td class="border fs-5 fw-medium">CU</td>
                        <td class="border fs-5 fw-medium">@DailyPlanCUShift_03</td>
                        <td class="border fs-5 fw-medium">@PlanCUShift_03_Range</td>
                        <td class="border fs-5 fw-medium">@TotalActualCUShift_03_Range</td>
                        <td class="border fs-5 fw-medium @(DiffCUShift_03 < 0 ? "text-danger" : "")">@DiffCUShift_03</td>
                        <td class="border fs-5 fw-medium">@Math.Round(TotalLossTimeCUShift_03_Range)</td>
                        <td class="border fs-5 fw-medium">@Math.Round(WorkingTimeElapsed_03_Range)</td>
                        <td class="border fs-5 fw-medium">@(ModelStartTimeCUShift_03?.ToString("HH:mm:ss") ?? "-")</td>
                        <td class="border fs-5 fw-medium">@(ModelEndTimeCUShift_03?.ToString("HH:mm:ss") ?? "-")</td>
                        <td class="border fs-5 fw-medium">@OprRatioCUShift_03.ToString("F2") %</td>
                        <td class="border fs-5 fw-medium">@WorkEffCUShift_03.ToString("F2") %</td>
                        <td class="border fs-5 fw-medium">@DefectRatioCUShift_03.ToString("F2") %</td>
                        <td class="border fs-5 fw-medium">@TotalEffCUShift_03.ToString("F2") %</td>
                        <td class="border fs-5 fw-medium">@(pph_CU_03 > 0 ? pph_CU_03.ToString("F2") : "-")</td>
                        <td class="border fs-5 fw-medium">@ModelChangesCUShift_03_Range</td>
                        <td class="border fs-5 fw-medium">@Math.Round(ModelTimeChangeCUShift_03_Range, 2)</td>
                    </tr>
                    <tr>
                        <td class="border fs-5 fw-medium">3</td>
                        <td class="border fs-5 fw-medium">CS</td>
                        <td class="border fs-5 fw-medium">@DailyPlanCSShift_03</td>
                        <td class="border fs-5 fw-medium">@PlanCSShift_03_Range</td>
                        <td class="border fs-5 fw-medium">@TotalActualCSShift_03_Range</td>
                        <td class="border fs-5 fw-medium @(DiffCSShift_03 < 0 ? "text-danger" : "")">@DiffCSShift_03</td>
                        <td class="border fs-5 fw-medium">@Math.Round(TotalLossTimeCSShift_03_Range)</td>
                        <td class="border fs-5 fw-medium">@Math.Round(WorkingTimeElapsed_03_Range)</td>
                        <td class="border fs-5 fw-medium">@(ModelStartTimeCSShift_03?.ToString("HH:mm:ss") ?? "-")</td>
                        <td class="border fs-5 fw-medium">@(ModelEndTimeCSShift_03?.ToString("HH:mm:ss") ?? "-")</td>
                        <td class="border fs-5 fw-medium">@OprRatioCSShift_03.ToString("F2") %</td>
                        <td class="border fs-5 fw-medium">@WorkEffCSShift_03.ToString("F2") %</td>
                        <td class="border fs-5 fw-medium">@DefectRatioCSShift_03.ToString("F2") %</td>
                        <td class="border fs-5 fw-medium">@TotalEffCSShift_03.ToString("F2") %</td>
                        <td class="border fs-5 fw-medium">@(pph_CS_03 > 0 ? pph_CS_03.ToString("F2") : "-")</td>
                        <td class="border fs-5 fw-medium">@ModelChangesCSShift_03_Range</td>
                        <td class="border fs-5 fw-medium">@Math.Round(ModelTimeChangeCSShift_03_Range, 2)</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="text-center mt-3 mx-3 table-responsive card rounded-3 p-0 m-0" id="OverallTable">
            <table class="table overflow-hidden p-0 m-0">
                <thead>
                    <tr class="align-middle">
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Total Overall</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Daily Plan</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Plan</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Act</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Difference</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Loss Time (min)</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Work Time (min)</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Opr. Ratio (%)</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Work Eff. (%)</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Pass Through Ratio (%)</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Total Eff. (%)</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);"># of Model Change</th>
                        <th class="text-white fw-medium border-end" style="background-color: rgb(61, 121, 176);">Model Chg Time (min)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th class="border fs-5 fw-medium" scope="row">Total CU</th>
                        <td class="border fs-5 fw-medium">@((Model.DailyPlanData.FirstOrDefault(p => p.MachineCode == "MCH1-01")?.Quantity ?? 0))</td>
                        <td class="border fs-5 fw-medium">@PlanCU_Overall</td>
                        <td class="border fs-5 fw-medium">@TotalActualCU_Overall</td>
                        <td class="border fs-5 fw-medium @(DiffCU_Overall < 0 ? "text-danger" : "")">@DiffCU_Overall</td>
                        <td class="border fs-5 fw-medium">@Math.Round(TotalLossTimeCU_Overall)</td>
                        <td class="border fs-5 fw-medium">@Math.Round(WorkingTimeElapsed_Overall)</td>
                        <td class="border fs-5 fw-medium">@OprRatioCU_Overall.ToString("F2") %</td>
                        <td class="border fs-5 fw-medium">
                            @if (PlanCU_Overall == 0 && TotalActualCU_Overall > 0)
                            {
                                <text>&infin; %</text>
                            }
                            else
                            {
                                @WorkEffCU_Overall.ToString("F2") <text>%</text>
                            }
                        </td>
                        <td class="border fs-5 fw-medium">@DefectRatioCU_Overall.ToString("F2") %</td>
                        <td class="border fs-5 fw-medium">
                            @if (PlanCU_Overall == 0 && TotalActualCU_Overall > 0)
                            {
                                <text>&infin; %</text>
                            }
                            else
                            {
                                @TotalEffCU_Overall.ToString("F2") <text>%</text>
                            }
                        </td>
                        <td class="border fs-5 fw-medium">@ModelChangesCU_Overall</td>
                        <td class="border fs-5 fw-medium">@Math.Round(ModelTimeChangeCU_Overall, 2)</td>
                    </tr>
                    <tr>
                        <th class="border fs-5 fw-medium" scope="row">Total CS</th>
                        <td class="border fs-5 fw-medium">@((Model.DailyPlanData.FirstOrDefault(p => p.MachineCode == "MCH1-02")?.Quantity ?? 0))</td>
                        <td class="border fs-5 fw-medium">@PlanCS_Overall</td>
                        <td class="border fs-5 fw-medium">@TotalActualCS_Overall</td>
                        <td class="border fs-5 fw-medium @(DiffCS_Overall < 0 ? "text-danger" : "")">@DiffCS_Overall</td>
                        <td class="border fs-5 fw-medium">@Math.Round(TotalLossTimeCS_Overall)</td>
                        <td class="border fs-5 fw-medium">@Math.Round(WorkingTimeElapsed_Overall)</td>
                        <td class="border fs-5 fw-medium">@OprRatioCS_Overall.ToString("F2") %</td>
                        <td class="border fs-5 fw-medium">
                            @if (PlanCS_Overall == 0 && TotalActualCS_Overall > 0)
                            {
                                <text>&infin; %</text>
                            }
                            else
                            {
                                @WorkEffCS_Overall.ToString("F2") <text>%</text>
                            }
                        </td>
                        <td class="border fs-5 fw-medium">@DefectRatioCS_Overall.ToString("F2") %</td>
                        <td class="border fs-5 fw-medium">
                            @if (PlanCS_Overall == 0 && TotalActualCS_Overall > 0)
                            {
                                <text>&infin; %</text>
                            }
                            else
                            {
                                @TotalEffCS_Overall.ToString("F2") <text>%</text>
                            }
                        </td>
                        <td class="border fs-5 fw-medium">@ModelChangesCS_Overall</td>
                        <td class="border fs-5 fw-medium">@Math.Round(ModelTimeChangeCS_Overall, 2)</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>