@page
@model MonitoringSystem.Pages.LossTimeReport.indexModel
@{
    ViewData["Title"] = "Loss Time Report";
    string[] months = { "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec", "Jan", "Feb", "Mar" };
}

<style>
/* FILTER AREA WITH LINES - SUPER COMPACT */
/* FILTER AREA WITH LINES - SUPER COMPACT */
.filter-area-with-lines {
    position: relative;
    padding: 1px 0;
    margin-bottom: 8px;
    margin-top: -20px;
    min-height: 10px;
    width: calc(100% - 14px);
    margin-left: 7px;
    margin-right: 7px;
}

.panamon-bottom-line,
.panamon-bottomm-line {
    position: absolute !important;
    left: 7px !important;  /* ← Ke container, bukan ke page */
    right: 7px !important;
   
    height: 2px !important;
    background: rgba(255, 255, 255, 0.04) !important;
    z-index: 999 !important;
    pointer-events: none !important;
    display: block !important;
}
.panamon-bottom-line {
    top: 0 !important;
    border-top: 2px solid rgba(255, 255, 255, 0.08) !important;
}

.panamon-bottomm-line {
    bottom: 0 !important;
    border-bottom: 2px solid rgba(255, 255, 255, 0.08) !important;
}

/* FILTER CONTENT - SUPER COMPACT */
.filter-content {
    position: relative;
    z-index: 2;
    padding: 6px 0;
    border-radius: 15px;
    margin-left: 7px;
    margin-right: 7px;
}
/* Bold style untuk dropdown yang sudah dipilih */
.filter-content .form-select-sm.selected {
    font-weight: 700 !important;
}

.filter-content .form-select-sm {
    height: 28px;
    padding: 0 22px 0 8px;
    font-size: 12px;
    line-height: 20px;
    border-radius: 999px;
    background-color: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(255, 255, 255, 0.5);
    color: #ffffff;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23ffffff' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m2 5 6 6 6-6'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 0.5rem center;
    background-size: 12px 12px;
}

.filter-content label {
    color: rgba(255, 255, 255, 0.85);

}

.filter-content .form-select-sm option {
    background-color: rgba(50, 60, 80, 0.95);
    color: #ffffff;
    font-size: 12px;
    padding: 8px;
}

.filter-content .form-select-sm option:hover {
    background-color: rgba(70, 85, 110, 0.95);
}

.filter-content .form-select:focus {
    background-color: rgba(255, 255, 255, 0.05);
    border-color: rgba(255, 255, 255, 0.3);
    color: #ffffff;
    box-shadow: 0 0 0 0.2rem rgba(255, 255, 255, 0.1);
}

.filter-content .btn {
    border-radius: 999px !important;
    height: 28px;
    min-height: 20px;
    font-size: 12px;
    line-height: 20px;
    padding: 0 12px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.filter-content .form-select-sm,
.filter-content .btn-sm {
    height: 28px;
    min-height: 20px;
    font-size: 12px;
    line-height: 20px;
}

.filter-content .form-select-sm {
    height: 28px;
    padding: 0;
    padding-left: 12px;
    padding-right: 28px;
    padding-top: -2px;
    font-size: 12px;
    line-height: 16px;
    border-radius: 999px;
    background-color: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(255, 255, 255, 0.5);
    color: #ffffff;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23ffffff' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m2 5 6 6 6-6'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 8px center;
    background-size: 10px 10px;
    text-align: center;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    display: flex;
    align-items: center;
    justify-content: center;
}

.filter-content .btn-sm {
    padding: 0 12px;
    border-radius: 999px;
}

.filter-content .form-check-input {
    width: 14px;
    height: 14px;
    margin-top: 2px;
    background-color: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.4);
    border-radius: 8px;
}

.filter-content .form-check-input:checked {
    background-color: #0d6efd;
    border-color: #0d6efd;
}

.filter-content label,
.filter-content .form-check-label {
    font-size: 12px;
    line-height: 20px;
}

.filter-content .btn-primary {
    background-color: rgba(8, 65, 150, 0.95);
    border: 2px solid rgba(100, 181, 246, 1);
    color: rgba(100, 181, 246, 1);
    font-weight: 600;
}

.filter-content .btn-primary:hover {
    background-color: rgba(5, 45, 110, 1);
    border-color: rgba(144, 202, 249, 1);
    color: rgba(144, 202, 249, 1);
}

.filter-content .btn-success {
    background-color: rgba(255, 255, 255, 0.05) !important;
    border: 2px solid rgba(255, 255, 255, 0.5) !important;
    color: #ffffff !important;
    font-weight: 600;
}

.filter-content .btn-success:hover {
    background-color: rgba(255, 255, 255, 0.1) !important;
    border-color: rgba(255, 255, 255, 0.7) !important;
}

/* CHART CONTAINER - SUPER COMPACT - SAMA PERSIS */
.chart-box {
    position: relative;
    width: calc(100% - 14px);
    max-width: 100%;
    height: auto;
    margin-top: 0.25rem;
    margin-bottom: 0.25rem;
    margin-left: 7px;
    margin-right: 7px;
    background: rgba(255, 255, 255, 0.20);
    border-radius: 12px;
    padding: 5px 12px 5px 12px; 
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3) !important;
    overflow: visible !important;
}

.chart-box h5 {
    font-size: 0.85rem;
    color: #ffffff;
    font-weight: 600;
    margin-bottom: 8px;
}

.chart-canvas {
    width: 100% !important;
    max-width: 100%;
    height: 350px !important;
    margin-bottom: 6px;
}

/* TABLE STYLING - COMPACT DENGAN SMOOTH HORIZONTAL SCROLL */
.table-responsive {
    max-width: calc(100% - 14px);
    margin-left: 7px;
    margin-right: 7px;
    overflow-x: auto;
    overflow-y: auto;
    max-height: calc(100vh - 480px);
    position: relative;
    border-radius: 8px;
    scroll-behavior: smooth;
    padding-bottom: 20px;
    margin-bottom: 30px;
}

/* SCROLLBAR HORIZONTAL - LEBIH TEBAL & JELAS */
.table-responsive::-webkit-scrollbar {
    height: 14px;
    width: 12px;
}

.table-responsive::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.5);
    border-radius: 7px;
    margin: 4px;
}

.table-responsive::-webkit-scrollbar-thumb {
    background: linear-gradient(180deg, #64b5f6, #42a5f5);
    border-radius: 7px;
    border: 3px solid rgba(0, 0, 0, 0.5);
}

.table-responsive::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(180deg, #90caf9, #64b5f6);
    cursor: grab;
}

.table-responsive::-webkit-scrollbar-thumb:active {
    cursor: grabbing;
}

.table-responsive::-webkit-scrollbar-corner {
    background: rgba(0, 0, 0, 0.5);
    border-radius: 7px;
}

.table-responsive {
    scrollbar-width: auto;
    scrollbar-color: #64b5f6 rgba(0, 0, 0, 0.5);
}

.table th,  
.table td {
    font-size: 11px;
    padding: 0.25rem;
    white-space: nowrap;
    word-wrap: break-word;
    vertical-align: middle;
}

/* STICKY FIRST COLUMN - DENGAN SHADOW GRADIENT */
.table th:first-child,
.table td:first-child {
    min-width: 70px !important;
    max-width: 70px !important;
    width: 70px !important;
    white-space: normal;
    text-align: left;
    padding-left: .25rem;
    padding-right: .25rem;
    padding-top: 0.15rem;
    padding-bottom: 0.15rem;
    font-size: 10px;
    line-height: 1.2;
    position: sticky;
    left: 0;
    background-color: rgba(255, 255, 255, 0.20) !important;
    z-index: 10;
    box-shadow: 3px 0 8px rgba(0, 0, 0, 0.3);
    border-right: 2px solid rgba(255, 255, 255, 0.3) !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.25) !important;
}

/* Sticky header first column dengan cursor pointer untuk yang clickable */
/* TABLE HEADER - SOLID BACKGROUND GAK TEMBUS PANDANG */
table.table thead th {
    background-color: rgba(30, 40, 60, 1) !important;  /* SOLID 100% - GAK TRANSPARAN */
    color: #ffffff !important;
    font-weight: 600;
    border-bottom: 2px solid rgba(100, 181, 246, 0.5) !important;
}

/* Sticky header first column dengan cursor pointer */
.table thead th:first-child {
    background-color: rgba(20, 30, 50, 1) !important;  /* SOLID & lebih gelap */
    z-index: 11;
    font-weight: 700;
}

.table thead th:first-child.toggle-header {
    cursor: pointer;
    user-select: none;
}

/* FIX LEBAR KOLOM BP & ACT - SEMUA SAMA */
/* Target hanya row kedua header (BP/Act) dan semua tbody cells */
.table thead tr:nth-child(2) th {
    min-width: 38px !important;
    max-width: 38px !important;
    width: 38px !important;
}

.table tbody td:not(:first-child) {
    min-width: 38px !important;
    max-width: 38px !important;
    width: 38px !important;
}

/* TABLE BACKGROUND - SAMA PERSIS */
.table.table {
    background-color: rgba(255, 255, 255, 0.20) !important;
}

@*table.table thead th {
    background-color: rgba(0, 0, 0, 0.7) !important;
    color: #ffffff !important;
}*@

table.table tbody td {
    background-color: transparent !important;
    color: #eaeaea !important;
}

table.table-bordered > :not(caption) > * {
    border-color: rgba(255, 255, 255, 0.2) !important;
}

.table-dark td:first-child {
    background-color: rgba(0, 0, 0, 0.7) !important;
    color: white !important;
    font-weight: 700;
    box-shadow: 3px 0 8px rgba(0, 0, 0, 0.3);
}

.table-secondary {
    background-color: rgba(255, 255, 255, 0.15) !important;
}

.table-secondary td:first-child {
    background-color: rgba(255, 255, 255, 0.15) !important;
    font-weight: 700;
    box-shadow: 3px 0 8px rgba(0, 0, 0, 0.3);
}

/* EXTRA ROW - HIDDEN BY DEFAULT */
.extra-row {
    display: none;
}

/* CRITICAL OVERFLOW CONTROL - SAMA PERSIS */
html, body {
    height: 100vh;
    margin: 0;
    padding: 0;
    overflow-x: hidden !important;
    overflow-y: auto !important;
    max-width: 100vw;
}

.container-fluid {
    max-width: 100%;
    overflow-x: visible !important;
    overflow-y: auto !important;
    height: auto;
    padding-left: 0px !important;
    padding-right: 0px !important;
}

main.pb-5 {
    padding-bottom: 0 !important;
    height: auto !important;
    overflow: visible !important;
    display: flex;
    flex-direction: column;
}

#reportContainer {
    height: auto !important;
    overflow: visible !important;
    display: flex;
    flex-direction: column;
    padding: 0 !important;
    margin: 0 !important;
}

#reportContainer > .container-fluid {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: visible !important;
    padding-left: 0 !important;
    padding-right: 0 !important;
}

.main-content-wrapper {
    padding-left: 0 !important;
    padding-right: 0 !important;
}

.main-content-wrapper .p-4 {
    padding-left: 1px !important;
    padding-right: 1px !important;
}
</style>

<div id="reportContainer">
    <div class="container-fluid">
        <!-- FILTER AREA WITH HORIZONTAL LINES -->
        <div class="filter-area-with-lines">    
            <!-- GARIS HORIZONTAL - ALWAYS SHOW -->
            <div class="panamon-bottom-line"></div>
            <div class="panamon-bottomm-line"></div>

            <div class="filter-content">
                <form method="get" id="filterForm" class="d-flex flex-wrap align-items-center gap-3">
                <!-- YEAR -->
                <div class="d-flex align-items-center gap-2">
                    <label class="mb-0 text-white small">Year</label>
                    <select class="form-select form-select-sm" style="width: 80px;" id="SelectedYear" name="SelectedYear" asp-for="SelectedYear">
                            @for (int i = DateTime.Now.Year; i >= 2020; i--)
                            {
                                    <option value="@i">@i</option>
                            }
                    </select>
                </div>

                <!-- MACHINE LINE -->
                <div class="d-flex align-items-center gap-2">
                    <label class="mb-0 text-white small">Line</label>
                    <select name="MachineLine" class="form-select form-select-sm" style="width: 90px;" asp-for="MachineLine">
                        <option value="All">All Lines</option>
                        <option value="MCH1-01">CU</option>
                        <option value="MCH1-02">CS</option>
                    </select>
                </div>

               <button type="submit" class="btn btn-sm btn-primary">
                    <i class="fas fa-filter me-2"></i>Apply
                </button>

                <button type="button" class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#uploadModal">
                    <i class="fas fa-file-excel me-2"></i>Manage BP
                </button>
            </form>
        </div>
    </div>

    <!-- TOAST NOTIFICATIONS -->
    <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1100">
            @if (TempData["Error"] != null)
            {
                    <div id="errorToast" class="toast align-items-center text-bg-danger border-0 shadow" role="alert">
                        <div class="d-flex">
                            <div class="toast-body">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                            @TempData["Error"]
                            </div>
                            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                        </div>
                    </div>
            }
            @if (TempData["Success"] != null)
            {
                    <div id="successToast" class="toast align-items-center text-bg-success border-0 shadow" role="alert">
                        <div class="d-flex">
                            <div class="toast-body">
                                <i class="fas fa-check-circle me-2"></i>
                            @TempData["Success"]
                            </div>
                            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                        </div>
                    </div>
            }
    </div>

    <!-- CHART WITH BOX - SAMA PERSIS DENGAN PRODUCTION REPORT -->
    <div class="chart-box">
        <h5 class="mb-0">
            Actual vs BP : @(Model.MachineLine == "All" ? "All Lines Combined" : Model.MachineLine)
            (Apr @Model.SelectedYear - Mar @(Model.SelectedYear + 1))
        </h5>
            @if (Model.ChartDataJson == "{}" || !Model.Categories.Any())
            {
                    <div class="alert alert-warning text-center mt-2" style="font-size: 0.75rem;">
                        No data found for Fiscal Year @Model.SelectedYear. Please check if data exists in database.
                    </div>
            }
        <canvas id="monthlyLossChart" class="chart-canvas"></canvas>
    </div>

    <!-- TABLE - DENGAN TOGGLE FEATURE -->
    <div class="table-responsive">
        <table class="table table-bordered text-center align-middle w-100 mb-0" id="lossTimeTable">
            <thead class="sticky-top">
                <tr>
                    <th rowspan="2" class="align-middle toggle-header" id="toggleExtraRows">
                        <div class="d-flex align-items-center">
                            <i id="toggleIcon" class="bi bi-chevron-down me-2"></i>
                            <span>Loss Category</span>
                        </div>
                    </th>
                        @foreach (var m in months)
                        {
                                <th colspan="2">@m</th>
                        }
                </tr>
                <tr>
                        @for (int i = 0; i < 12; i++)
                        {
                                <th class="fw-bold small">BP</th>
                                <th class="fw-bold small">Act</th>
                        }
                </tr>
            </thead>
            <tbody>
                    @if (Model.Categories.Any())
                    {
                        string currentGroup = "";

                        foreach (var cat in Model.Categories)
                        {
                            string groupName = Model.GetCategoryGroup(cat);
                            bool isWorkingLoss = groupName.Equals("WORKING LOSS", StringComparison.OrdinalIgnoreCase);
                            string rowClass = isWorkingLoss ? "" : "extra-row";

                            if (groupName != currentGroup)
                            {
                                                    <tr class="table-secondary @rowClass">
                                                        <td colspan="25" class="text-center fw-bold text-uppercase py-1" style="letter-spacing: 1px;">
                                        @groupName
                                                        </td>
                                                    </tr>
                                currentGroup = groupName;
                            }

                                        <tr class="@rowClass">
                                            <td class="text-start fw-bold">@cat</td>
                                @for (int i = 0; i < 12; i++)
                                {
                                    var planVal = Model.DetailPlans.ContainsKey(cat) ? Model.DetailPlans[cat][i] : 0;
                                    var actVal = Model.DetailActuals.ContainsKey(cat) ? Model.DetailActuals[cat][i] : 0;

                                                        <td class="text-center fw-bold">@planVal</td>
                                                        <td class="text-center fw-bold">@actVal</td>
                                }
                                        </tr>
                        }
                            <tr class="table-dark fw-bold extra-row">
                                <td class="text-start">TOTAL LOSS</td>
                            @for (int i = 0; i < 12; i++)
                            {
                                            <td>@Model.TotalPlanPerMonth[i].ToString("N1")</td>
                                            <td>@Model.TotalActualPerMonth[i].ToString("N1")</td>
                            }
                            </tr>
                    }
                    else
                    {
                            <tr><td colspan="25">No Data Available</td></tr>
                    }
            </tbody>
        </table>
    </div>
    </div>
</div>

<!-- UPLOAD MODAL -->
<div class="modal fade" id="uploadModal" tabindex="-1" aria-labelledby="uploadModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="uploadModalLabel"><i class="fas fa-file-upload"></i> Upload BP Data</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="post" enctype="multipart/form-data" asp-page-handler="ImportExcel">
                <div class="modal-body">
                    <input type="hidden" name="SelectedYear" value="@Model.SelectedYear" />
                    <input type="hidden" name="MachineLine" value="@Model.MachineLine" />
                    <div class="mb-3">
                        <label class="form-label fw-bold">1. Select Target Machine for Plan</label>
                        <select name="UploadMachineLine" class="form-select" required>
                            <option value="MCH1-01">MCH1-01 (CU)</option>
                            <option value="MCH1-02">MCH1-02 (CS)</option>
                        </select>
                        <div class="form-text text-muted">You must specify which machine this file belongs to.</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">2. Choose Excel File</label>
                        <input type="file" name="UploadedExcel" class="form-control" accept=".xlsx" required />
                    </div>
                    <hr />
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="small text-muted">Need the format?</span>
                        <a asp-page-handler="DownloadTemplate" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-download"></i> Download Template
                        </a>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-small text-white" style="background-color: rgb(25, 135, 84);">Import BP</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="~/js/chart.umd.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        // TOGGLE EXTRA ROWS FUNCTIONALITY
        document.getElementById('toggleExtraRows')?.addEventListener('click', function () {
            const extraRows = document.querySelectorAll('.extra-row');
            const icon = document.getElementById('toggleIcon');
            const isVisible = extraRows[0]?.style.display === 'table-row';

            extraRows.forEach(row => row.style.display = isVisible ? 'none' : 'table-row');

            icon?.classList.toggle('bi-chevron-down', isVisible);
            icon?.classList.toggle('bi-chevron-up', !isVisible);
        });

        // CHART RENDERING
        var chartData = @Html.Raw(Model.ChartDataJson);
        var ctx = document.getElementById('monthlyLossChart').getContext('2d');

        const barColors = [
            '#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b',
            '#858796', '#5a5c69', '#fd7e14', '#20c997', '#6f42c1'
        ];

        let datasets = [];
        let colorIdx = 0;

        if(chartData.Categories){
            chartData.Categories.forEach((cat) => {
                let color = barColors[colorIdx % barColors.length];

                datasets.push({
                    label: cat + ' (Act)',
                    data: chartData.Actuals[cat],
                    backgroundColor: color,
                    stack: 'Actual',
                    order: 2
                });

                datasets.push({
                    label: cat + ' (Plan)',
                    data: chartData.Plans[cat],
                    backgroundColor: color,
                    stack: 'Plan',
                    opacity: 0.6,
                    order: 2
                });
                colorIdx++;
            });
        }

        datasets.push({
            label: 'Actual Ratio (%)',
            data: chartData.RatioActual,
            type: 'line',
            borderColor: '#e74a3b',
            backgroundColor: '#e74a3b',
            borderWidth: 3,
            pointRadius: 4,
            yAxisID: 'y_ratio',
            tension: 0.1,
            order: 0
        });

        datasets.push({
            label: 'Plan Ratio (%)',
            data: chartData.RatioPlan,
            type: 'line',
            borderColor: '#4e73df',
            backgroundColor: '#4e73df',
            borderWidth: 2,
            borderDash: [5, 5],
            pointRadius: 3,
            yAxisID: 'y_ratio',
            tension: 0.1,
            order: 0
        });

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: chartData.Labels,
                datasets: datasets
            },
            options: {
                devicePixelRatio: 3,
                responsive: true,
                maintainAspectRatio: false,
                animation: { duration: 500 },
               layout: {
                    padding: {
                        bottom: 0,
                        top: 10,
                        left: 5,
                        right: 5
                    }
                },
                plugins: {
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        titleColor: '#ffffff',
                        bodyColor: '#ffffff',
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) label += ': ';
                                if (context.parsed.y !== null) {
                                    label += context.parsed.y;
                                    if (context.dataset.yAxisID === 'y_ratio') label += '%';
                                }
                                return label;
                            }
                        }
                    },
                   legend: { 
    display: false,
    position: 'bottom',
    labels: { 
        color: '#ffffff',
        boxWidth: 12,
        boxHeight: 12,
        padding: 8,
        font: {
            size: 9
        },
        usePointStyle: false
    },
    maxHeight: 120,
    align: 'start',
    onClick: function(e, legendItem, legend) {
        const index = legendItem.datasetIndex;
        const chart = legend.chart;

        // Toggle visibility menggunakan API yang benar
        if (chart.isDatasetVisible(index)) {
            chart.hide(index);
        } else {
            chart.show(index);
        }
    },
    onHover: function(e, legendItem, legend) {
        e.native.target.style.cursor = 'pointer';
    },
    onLeave: function(e, legendItem, legend) {
        e.native.target.style.cursor = 'default';
    }
}
                },
                scales: {
                    x: {
                        stacked: true,
                        title: { display: true, text: 'Fiscal Month', color: '#ffffff' },
                        ticks: { color: '#ffffff' }
                    },
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        stacked: true,
                        title: { display: true, text: 'Loss Time (Minutes)', color: '#ffffff' },
                        ticks: { color: '#ffffff' }
                    },
                    y_ratio: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        grid: {
                            drawOnChartArea: false
                        },
                        title: { display: true, text: 'Ratio (%)', color: '#ffffff' },
                        ticks: {
                            color: '#ffffff',
                            callback: function(value) { return value + "%" }
                        },
                        suggestedMax: 5
                    }
                }
            }
        });
    });
    document.addEventListener('DOMContentLoaded', function() {
        // Function untuk set bold pada dropdown yang sudah dipilih
        function updateDropdownStyle() {
            const dropdowns = document.querySelectorAll('.filter-content .form-select-sm');

            dropdowns.forEach(dropdown => {
                const dropdownId = dropdown.id;
                const dropdownValue = dropdown.value;

                // Logic untuk masing-masing dropdown
                if (dropdownId === 'SelectedYear') {
                    // Year selalu bold setelah dipilih
                    if (dropdownValue) {
                        dropdown.classList.add('selected');
                    }
                } else if (dropdown.name === 'MachineLine') {
                    // Machine Line bold jika bukan "All"
                    if (dropdownValue && dropdownValue !== 'All') {
                        dropdown.classList.add('selected');
                    } else {
                        dropdown.classList.remove('selected');
                    }
                }
            });
        }

        // Jalankan saat halaman load
        updateDropdownStyle();

        // Jalankan saat dropdown berubah
        const dropdowns = document.querySelectorAll('.filter-content .form-select-sm');
        dropdowns.forEach(dropdown => {
            dropdown.addEventListener('change', updateDropdownStyle);
        });
    });
</script>